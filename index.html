<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ°´æœåº«å­˜èˆ‡åƒ¹æ ¼ (Supabase + Vercel)</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body {
    font-family: system-ui;
    padding: 24px;
  }
  h1 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 16px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    max-width: 500px;
  }
  th, td {
    padding: 10px 12px;
    border-bottom: 1px solid #ccc;
  }
  th {
    text-align: left;
  }
  .debug {
    margin-top: 20px;
    font-family: monospace;
    color: #444;
    background: #f6f6f6;
    padding: 12px;
    border-radius: 6px;
    font-size: 13px;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<h1>æ°´æœåº«å­˜èˆ‡åƒ¹æ ¼</h1>

<table id="fruit-table">
  <thead>
    <tr>
      <th>åç¨±</th>
      <th>åº«å­˜</th>
      <th>åƒ¹æ ¼</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="3">è¼‰å…¥ä¸­...</td></tr>
  </tbody>
</table>

<div id="debug" class="debug"></div>

<script>
(async () => {
  const debug = (msg) => {
    document.querySelector("#debug").innerHTML += msg + "\n";
  };

  debug("è¼‰å…¥ Supabase SDK...");

  if (!window.supabase) {
    debug("âŒ Supabase SDK æ²’è¼‰åˆ°");
    return;
  }

  debug("å»ºç«‹ Supabase client...");

  // ğŸ‘‰ğŸ‘‰ğŸ‘‰ ä½ åªè¦æ”¹é€™è£¡çš„ key
  const supabase = window.supabase.createClient(
    "https://krfqqkukafhqieaygyka.supabase.co",
    "sb-publishable-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" // â† æ›æˆä½ çš„
  );

  debug("æŸ¥è©¢ fruits...");

  const tbody = document.querySelector("#fruit-table tbody");

  try {
    const { data, error } = await supabase
      .from("fruits")
      .select("*")
      .order("id");

    debug("å›å‚³ data = " + JSON.stringify(data, null, 2));
    debug("å›å‚³ error = " + JSON.stringify(error, null, 2));

    if (error) {
      tbody.innerHTML = `<tr><td colspan="3">âŒ éŒ¯èª¤ï¼š${error.message}</td></tr>`;
      return;
    }

    if (!data || data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="3">è³‡æ–™è¡¨æ˜¯ç©ºçš„</td></tr>`;
      return;
    }

    tbody.innerHTML = "";
    data.forEach((f) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${f.name}</td>
        <td>${f.stock}</td>
        <td>${f.price}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (e) {
    debug("ä¾‹å¤– = " + e.message);
    tbody.innerHTML = `<tr><td colspan="3">ä¾‹å¤–ï¼š${e.message}</td></tr>`;
  }
})();
</script>

</body>
</html>
